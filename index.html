<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tr√°i tim Trung Thu ‚ú®üåï</title>
  <meta name="description" content="Tr√°i tim h·∫°t li ti ƒë·∫≠p nh·∫π ·ªü gi·ªØa m√†n h√¨nh, v√≤ng ch·ªØ ch√∫c Trung Thu xoay nh∆∞ c√°i ƒë·∫ø, h·∫°t nh·ªè bay v√†o tim, n·ªÅn b·∫ßu tr·ªùi ƒë√™m c√≥ l·ªìng ƒë√®n bay ch·∫≠m & b·∫≠t nh·∫°c ngay (nhac.mp3)." />
  <meta name="theme-color" content="#050814" />
  <style>
    /* --------------------------------------------------
       1) RESET & BI·∫æN TO√ÄN C·ª§C
       -------------------------------------------------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    html { color-scheme: dark; }
    body {
      margin: 0;
      font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: #e7ecff;
      background: radial-gradient(1200px 800px at 70% -10%, #1b2a5a 0%, #0a1430 45%, #050814 70%, #030611 100%);
      overflow: hidden;
    }

    /* Ng√¥i sao nh·ªè l·∫•p l√°nh ƒë∆°n gi·∫£n (nhi·ªÅu l·ªõp ƒë·ªÉ c√≥ chi·ªÅu s√¢u) */
    .stars, .stars::before, .stars::after {
      position: absolute; inset: -50% -50% -50% -50%; content: ""; pointer-events: none;
      background-image:
        radial-gradient(1px 1px at 25% 40%, #fff8 50%, transparent 55%),
        radial-gradient(1px 1px at 65% 25%, #fff6 50%, transparent 55%),
        radial-gradient(1px 1px at 80% 60%, #fff8 50%, transparent 55%),
        radial-gradient(1px 1px at 15% 70%, #fff5 50%, transparent 55%),
        radial-gradient(1px 1px at 45% 85%, #fff7 50%, transparent 55%),
        radial-gradient(1px 1px at 90% 10%, #fff6 50%, transparent 55%),
        radial-gradient(1px 1px at 5% 15%,  #fff7 50%, transparent 55%);
      background-repeat: repeat;
      background-size: 600px 600px;
      opacity: .7;
      animation: twinkle 18s linear infinite;
    }
    .stars::before { animation-duration: 26s; opacity: .6; filter: blur(.3px); }
    .stars::after  { animation-duration: 32s; opacity: .5; filter: blur(.6px); }
    @keyframes twinkle { to { transform: translateY(-40px); } }

    /* TrƒÉng nh·∫π g√≥c ph·∫£i */
    .moon {
      position: absolute; right: 6vw; top: 6vh; width: 120px; height: 120px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff8 0, #fff6 25%, #ffd 45%, #e6e6b6 60%, #0000 62%),
                  radial-gradient(70px 70px at 60% 60%, #fff3 0, #0000 70%);
      box-shadow: 0 0 40px 10px #ffe9a8aa, 0 0 120px 40px #ffe9a84d;
      filter: saturate(1.1);
      pointer-events: none;
    }

    /* --------------------------------------------------
       2) L·ªíNG ƒê√àN BAY (SVG + CSS)
       -------------------------------------------------- */
    .lanterns { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
    .lantern { position: absolute; bottom: -20vh; width: 80px; height: 120px; opacity: .85;
      animation: floatUp linear infinite;
      filter: drop-shadow(0 0 6px #ffb23a) drop-shadow(0 0 16px #ff7b29);
    }
    .lantern svg { width: 100%; height: 100%; }
    .lantern:nth-child(odd){ animation-duration: 42s; }
    .lantern:nth-child(even){ animation-duration: 52s; }
    .lantern .glow { animation: glow 3s ease-in-out infinite; transform-origin: 50% 50%; }

    @keyframes floatUp {
      from { transform: translateY(0) translateX(0) rotate(0.2deg); }
      to   { transform: translateY(-140vh) translateX(-20px) rotate(-0.2deg); }
    }
    @keyframes glow { 0%,100%{ opacity: .9 } 50%{ opacity: .5 } }

    /* --------------------------------------------------
       3) CANVAS TR√ÅI TIM + H·∫†T BAY V√ÄO TIM
       -------------------------------------------------- */
    #scene { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }

    /* --------------------------------------------------
       4) V√íNG CH·ªÆ QUAY NH∆Ø C√ÅI ƒê·∫æ ‚Äì 3D ch·ªØ quanh tim
       -------------------------------------------------- */
    .rings {
      position: absolute; left: 50%; bottom: 8vh; transform: translateX(-50%);
      width: min(90vw, 900px); height: 42vh; pointer-events: none; perspective: 1200px;
    }
    .ring {
      position: absolute; left: 50%; bottom: 0; transform-style: preserve-3d;
      --radius: 300px;  /* b√°n k√≠nh v√≤ng */
      --tilt: 68deg;    /* nghi√™ng ƒë·ªÉ t·∫°o c·∫£m gi√°c c√°i ƒë·∫ø */
      --speed: 28s;     /* t·ªëc ƒë·ªô quay */
      --dir: 1;         /* h∆∞·ªõng quay */
      --y: 0px;         /* n√¢ng h·∫° v√≤ng */
      animation: spin var(--speed) linear infinite;
      transform: translateX(-50%) translateY(var(--y)) rotateX(var(--tilt));
      filter: drop-shadow(0 10px 8px #000a);
    }
    @keyframes spin { to { transform: translateX(-50%) translateY(var(--y)) rotateX(var(--tilt)) rotateY(calc(var(--dir)*1turn)); } }

    .ring .char { position: absolute; left: 50%; top: 50%; transform-origin: 0 0; white-space: pre; font-weight: 800; letter-spacing: 1px; }
    .ring .char s { text-decoration: none; opacity: .25; } /* d·∫•u ch·∫•m ngƒÉn c√°ch m·ªù h∆°n */

    /* Hi·ªáu ·ª©ng loang s√°ng v√†o ch·ªØ ƒë·ªÉ n·ªïi */
    .ring .char { color: #fff; text-shadow: 0 1px 0 #0009, 0 0 12px #9ad2ff90, 0 0 24px #43d1ff50; }

    /* --------------------------------------------------
       5) N√öT √ÇM THANH & C·ª¨A CH·∫∂N T·ª∞ ƒê·ªòNG PH√ÅT
       -------------------------------------------------- */
    .controls { position: fixed; right: 14px; bottom: 14px; z-index: 50; display: flex; gap: 10px; }
    .btn {
      -webkit-tap-highlight-color: transparent;
      background: #0b1b3a99; border: 1px solid #2c3c88; color: #e8f3ff; padding: 10px 14px; border-radius: 12px;
      backdrop-filter: blur(6px); box-shadow: 0 4px 20px #0008 inset, 0 0 18px #3aa9ff33;
      font-weight: 700; cursor: pointer; user-select: none;
    }
    .btn:hover { filter: brightness(1.15); }

    .gate { position: fixed; inset: 0; display: grid; place-items: center; background: #000a; z-index: 80; }
    .gate .panel { background: linear-gradient(180deg,#0a1640dd,#040a20ee); border: 1px solid #2f4aa6; padding: 22px; border-radius: 16px; box-shadow: 0 10px 50px #000c, 0 0 60px #4dc8ff33 inset; text-align: center; }
    .gate h1 { margin: 0 0 8px; font-size: 24px; }
    .hide { display: none !important; }

    /* H∆∞·ªõng d·∫´n th√™m: ch·ªØ ·ªü g√≥c tr√™n c√πng ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt ƒë·∫∑t file nh·∫°c */
    .hint { position: fixed; left: 12px; top: 10px; font-size: 12px; opacity: .8; color: #c7d6ff; z-index: 10; }
  </style>
</head>
<body>
  <!-- N·ªÄN sao & trƒÉng -->
  <div class="stars"></div>
  <div class="moon"></div>

  <!-- L·ªíNG ƒê√àN bay ch·∫≠m r√£i (SVG inline ƒë·ªÉ d√πng 1 file) -->
  <div class="lanterns" id="lanterns"></div>

  <!-- CANVAS: Tr√°i tim b·∫±ng h·∫°t li ti + h·∫°t bay v√†o tim -->
  <canvas id="scene" aria-hidden="true"></canvas>

  <!-- C√°c v√≤ng ch·ªØ quay quanh tim nh∆∞ c√°i ƒë·∫ø -->
  <div class="rings" id="rings" aria-hidden="true"></div>

  <!-- Nh·∫°c n·ªÅn: ƒë·∫∑t file nhac.mp3 c√πng th∆∞ m·ª•c. Tr√¨nh duy·ªát s·∫Ω th·ª≠ auto-play; n·∫øu ch·∫∑n th√¨ hi·ªán l·ªõp gate. -->
  <audio id="bgm" src="nhac.mp3" preload="auto" loop playsinline></audio>

  <div class="controls">
    <button class="btn" id="toggleMute" title="B·∫≠t/t·∫Øt nh·∫°c">üîä ƒêang ph√°t</button>
  </div>

  <div id="gate" class="gate hide" role="dialog" aria-modal="true">
    <div class="panel">
      <h1>üéµ M·ªü nh·∫°c Trung Thu?</h1>
      <p>Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ b·∫≠t nh·∫°c n·ªÅn (do tr√¨nh duy·ªát ch·∫∑n t·ª± ƒë·ªông ph√°t).</p>
      <button id="gatePlay" class="btn">B·∫≠t nh·∫°c</button>
    </div>
  </div>

  <div class="hint">üí° ƒê·∫∑t file <b>nhac.mp3</b> c·∫°nh file HTML n√†y ƒë·ªÉ c√≥ nh·∫°c khi m·ªü trang.</div>

  <script>
  /* ======================================================================
     TRUNG THU HEART ‚Äì SINGLE FILE (HTML/CSS/JS)
     - Tr√°i tim l·ªõn gi·ªØa m√†n h√¨nh t·∫°o t·ª´ h·∫°t li ti, ƒë·ªïi m√†u nh·∫π v√† ƒë·∫≠p nh·∫π.
     - B√™n d∆∞·ªõi l√† c√°c v√≤ng ch·ªØ ch√∫c Trung Thu quay nhi·ªÅu l·ªõp nh∆∞ c√°i ƒë·∫ø.
     - M·ªôt s·ªë h·∫°t nh·ªè bay t·ª´ d∆∞·ªõi l√™n r·ªìi ho√† v√†o tr√°i tim.
     - N·ªÅn c√≥ trƒÉng, sao, l·ªìng ƒë√®n bay ch·∫≠m r√£i.
     - Nh·∫°c t·ª± ph√°t n·∫øu tr√¨nh duy·ªát cho ph√©p; n·∫øu kh√¥ng s·∫Ω hi·ªán l·ªõp xin ph√©p.
     ---------------------------------------------------------------------- */
  (() => {
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    const canvas = document.getElementById('scene');
    const ctx = canvas.getContext('2d');
    const ringsEl = document.getElementById('rings');

    const state = { w: 0, h: 0, cx: 0, cy: 0, scale: 1 };

    function resize(){
      state.w = Math.floor(innerWidth * dpr);
      state.h = Math.floor(innerHeight * dpr);
      canvas.width = state.w; canvas.height = state.h;
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      state.cx = state.w/2; state.cy = state.h * 0.40; // tim ·ªü 40% chi·ªÅu cao
      state.scale = Math.min(state.w, state.h) * 0.35; // k√≠ch th∆∞·ªõc tim
    }
    addEventListener('resize', resize); resize();

    /* ----------------------------------------
       1) T·∫†O H√åNH TR√ÅI TIM (ƒëi·ªÅu ki·ªán ·∫©n h√†m tim)
       C√¥ng th·ª©c implicit: (x^2 + y^2 - 1)^3 - x^2*y^3 <= 0
       Ta random ƒëi·ªÉm trong h·ªôp [-1.3,1.3]^2 ƒë·ªÉ l·∫•p k√≠n m·∫∑t tim.
       ---------------------------------------- */
    const HEART_BOX = 1.3;           // bi√™n th·ª≠ ƒëi·ªÉm
    const HEART_COUNT = 3400;        // s·ªë h·∫°t t·∫°o n√™n tim
    const heartPts = [];

    function inHeart(x,y){
      const a = x*x + y*y - 1;
      return (a*a*a - x*x*y*y*y) <= 0;
    }
    function buildHeart(){
      heartPts.length = 0;
      while(heartPts.length < HEART_COUNT){
        const x = (Math.random()*2 - 1) * HEART_BOX;
        const y = (Math.random()*2 - 1) * HEART_BOX;
        if(inHeart(x,y)){
          heartPts.push({x, y, hue: Math.random()*60, jx: (Math.random()-.5)*0.006, jy: (Math.random()-.5)*0.006});
        }
      }
    }
    buildHeart();

    /* ----------------------------------------
       2) H·∫†T BAY T·ª™ D∆Ø·ªöI L√äN V√ÄO TIM
       ---------------------------------------- */
    const RISERS = [];
    const RISER_COUNT = 80;
    function spawnRiser(r){
      const boxW = Math.min(state.w/dpr, 900) * 0.60; // v√πng ph√°t b√™n d∆∞·ªõi tim
      const x = innerWidth/2 + (Math.random() - .5) * boxW;
      const y = innerHeight*0.80 + Math.random()*40; // d∆∞·ªõi tim
      r.x = x * dpr; r.y = y * dpr; r.vx = (Math.random()-.5)*0.15*dpr; r.vy = - (0.6 + Math.random()*0.6) * dpr;
      r.ax = 0; r.ay = -0.002*dpr; r.life = 1; r.target = null; r.size = 1 + Math.random()*1.4;
    }
    for(let i=0;i<RISER_COUNT;i++) RISERS.push({}), spawnRiser(RISERS[i]);

    // Ch·ªçn ƒëi·ªÉm b·∫•t k·ª≥ b√™n trong tim l√†m ƒë√≠ch ƒë·ªÉ h·∫°t chui v√†o
    function pickHeartPixel(){
      const p = heartPts[(Math.random()*heartPts.length)|0];
      // chuy·ªÉn ƒë·ªïi sang to·∫° ƒë·ªô canvas pixel ngay l√∫c render m·ªõi chu·∫©n, n√™n t·∫°m tr·∫£ p, l√∫c d√πng s·∫Ω quy ƒë·ªïi.
      return p;
    }

    /* ----------------------------------------
       3) V·∫º/ANIMATE TIM & H·∫†T
       ---------------------------------------- */
    let t0 = performance.now();
    function draw(){
      const t = performance.now();
      const dt = Math.min(40, t - t0); // ms
      t0 = t;

      // n·ªÅn m·ªù ƒëen nh·∫π ƒë·ªÉ h·∫°t ƒëu√¥i m∆∞·ª£t (motion trail) ‚Äì r·∫•t nh·∫π th√¥i
      ctx.fillStyle = 'rgba(0,0,0,0.25)';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // Nh·ªãp ƒë·∫≠p: scale dao ƒë·ªông 3‚Äì4%
      const beat = 1 + 0.035 * Math.sin(t*0.0047);
      const baseS = state.scale * beat;

      // Hue t·ªïng th·ªÉ ch·∫°y ch·∫≠m ƒë·ªÉ tim ƒë·ªïi m√†u d·ªãu
      const hue = (t*0.02) % 360;

      // V·∫º TIM b·∫±ng c√°c h·∫°t
      ctx.save();
      for(let i=0;i<heartPts.length;i++){
        const p = heartPts[i];
        // jitter nh·∫π ƒë·ªÉ c√≥ c·∫£m gi√°c sinh ƒë·ªông
        const jx = Math.sin(t*0.002 + i)*p.jx;
        const jy = Math.cos(t*0.0023 + i)*p.jy;
        const x = state.cx + (p.x + jx) * baseS;
        const y = state.cy - (p.y + jy) * baseS; // tr·ª•c canvas y xu·ªëng d∆∞·ªõi, n√™n tr·ª´
        // m√†u theo hue t·ªïng + l·ªách nh·∫π t·ª´ng h·∫°t
        ctx.fillStyle = `hsla(${(hue+p.hue)%360}, 90%, 65%, 0.92)`;
        ctx.fillRect(x, y, 1.2*dpr, 1.2*dpr);
      }
      ctx.restore();

      // H·∫†T BAY T·ª™ D∆Ø·ªöI L√äN
      for(const r of RISERS){
        if(!r.target && (r.y/dpr) < innerHeight*0.53){
          // khi ƒë√£ ti·∫øn g·∫ßn tim th√¨ ch·ªçn m·ªôt ƒëi·ªÉm trong tim ƒë·ªÉ lao v√†o
          r.target = pickHeartPixel();
        }
        if(r.target){
          const tx = state.cx + r.target.x * baseS;
          const ty = state.cy - r.target.y * baseS;
          const dx = tx - r.x, dy = ty - r.y;
          r.vx += dx * 0.00008; r.vy += dy * 0.00008; // h√∫t v√†o tim
          r.vx *= 0.96; r.vy *= 0.96;
          r.life -= 0.008; // m·ªù d·∫ßn khi chu·∫©n b·ªã ho√† v√†o tim
          if(Math.hypot(dx,dy) < 6*dpr || r.life <= 0){ spawnRiser(r); continue; }
        } else {
          r.vy += r.ay * dt; // gia t·ªëc nh·∫π l√™n tr√™n
        }
        r.x += r.vx; r.y += r.vy;
        ctx.beginPath();
        ctx.fillStyle = `hsla(${(hue+20)%360}, 100%, 78%, ${Math.max(0.2, r.life)})`;
        ctx.arc(r.x, r.y, r.size*dpr, 0, Math.PI*2);
        ctx.fill();
      }

      requestAnimationFrame(draw);
    }
    draw();

    /* ----------------------------------------
       4) V√íNG CH·ªÆ CH√öC TRUNG THU ‚Äì nhi·ªÅu l·ªõp
       T·∫°o 3‚Äì4 v√≤ng, m·ªói v√≤ng m·ªôt b√°n k√≠nh, t·ªëc ƒë·ªô v√† n·ªôi dung ri√™ng.
       ---------------------------------------- */
    const wishes = [
      'Ch√∫c Trung Thu ·∫•m √°p',
      'Gia ƒë√¨nh ƒëo√†n vi√™n',
      'TrƒÉng tr√≤n nh∆∞ √Ω',
      'S·ª©c kh·ªèe ‚Äì H·∫°nh ph√∫c',
      'M·ªçi ƒëi·ªÅu b√¨nh an',
      'Vui h·ªôi TrƒÉng R·∫±m',
      'Ti·∫øng c∆∞·ªùi r·ªôn r√†ng',
      'ƒê√®n l·ªìng r·ª±c r·ª°',
      'B√°nh n∆∞·ªõng d·∫ªo th∆°m',
      'Th√†nh c√¥ng vi√™n m√£n',
      'An khang th·ªãnh v∆∞·ª£ng',
      'T√¨nh th√¢n g·∫Øn k·∫øt',
      '∆Ø·ªõc m∆° tr√≤n ƒë·∫ßy',
      'T√¢m an v·∫°n s·ª± an',
      'Y√™u th∆∞∆°ng lan t·ªèa',
      'H·ªçc h√†nh t·∫•n t·ªõi',
      'T√†i l·ªôc ƒë·ªß ƒë·∫ßy',
      'NƒÉm m·ªõi trƒÉng r·∫±m (T·∫øt Trung Thu) vui',
      'B√¨nh y√™n m·ªói ng√†y',
      'N·ª• c∆∞·ªùi to·∫£ n·∫Øng'
    ];

    // h√†m t·∫°o 1 v√≤ng ch·ªØ ‚Äì x·∫øp c√°c k√Ω t·ª± quanh v√≤ng tr√≤n
    function createRing({radius, y=0, speed=28, dir=1, text}){
      const ring = document.createElement('div');
      ring.className = 'ring';
      ring.style.setProperty('--radius', radius + 'px');
      ring.style.setProperty('--y', (-y) + 'px');
      ring.style.setProperty('--speed', speed + 's');
      ring.style.setProperty('--dir', dir);

      // l·∫∑p n·ªôi dung ƒë·ªÉ v√≤ng ƒë·ªß d√†y
      const content = (text + '  ‚Ä¢  ').repeat(24);
      const chars = [...content];
      const step = 360 / chars.length; // g√≥c xoay m·ªói k√Ω t·ª±
      for(let i=0;i<chars.length;i++){
        const span = document.createElement('span');
        span.className = 'char';
        // xoay quanh t√¢m & ƒë·∫©y ra b√°n k√≠nh ƒë√£ ƒë·ªãnh
        span.style.transform = `rotate(${i*step}deg) translate(var(--radius)) rotate(90deg)`;
        span.textContent = chars[i];
        // k√Ω t·ª± d·∫•u ch·∫•m th√™m m·ªù ƒë·ªÉ gi·ªëng ph√¢n c√°ch
        if(chars[i] === '‚Ä¢'){ const s = document.createElement('s'); s.textContent = '‚Ä¢'; span.textContent = ''; span.appendChild(s); }
        ring.appendChild(span);
      }
      ringsEl.appendChild(ring);
      return ring;
    }

    // t·∫°o nhi·ªÅu v√≤ng v·ªõi th√¥ng s·ªë kh√°c nhau t·∫°o chi·ªÅu s√¢u
    const baseR = Math.min(innerWidth, 900) * 0.42;
    const ringConfs = [
      { radius: baseR*0.95, y: -2, speed: 36, dir: 1,  text: wishes.slice(0,10).join(' ¬∑ ') },
      { radius: baseR*0.78, y: 18, speed: 30, dir: -1, text: wishes.slice(10,20).join(' ¬∑ ') },
      { radius: baseR*0.60, y: 36, speed: 22, dir: 1,  text: wishes.slice(0,20).reverse().join(' ¬∑ ') },
      { radius: baseR*0.42, y: 50, speed: 18, dir: -1, text: 'Ch√∫c Trung Thu an l√†nh ¬∑ TrƒÉng r·∫±m s√°ng l√≥a ¬∑ V·∫°n s·ª± nh∆∞ √Ω ¬∑ ' }
    ];
    ringConfs.forEach(cfg => createRing(cfg));

    /* ----------------------------------------
       5) L·ªíNG ƒê√àN SVG ‚Äì sinh nhi·ªÅu chi·∫øc, bay ch·∫≠m r√£i
       ---------------------------------------- */
    function lanternSVG(){
      return `
      <svg viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#ffdf6b"/>
            <stop offset="45%" stop-color="#ff9b3a"/>
            <stop offset="100%" stop-color="#ff6a2a"/>
          </linearGradient>
          <radialGradient id="glow" cx="50%" cy="45%" r="55%">
            <stop offset="0%" stop-color="#fff6"/>
            <stop offset="60%" stop-color="#0000"/>
          </radialGradient>
        </defs>
        <!-- ph·∫ßn th√¢n -->
        <ellipse cx="50" cy="65" rx="34" ry="42" fill="url(#g1)" stroke="#7c2f00" stroke-width="2"/>
        <ellipse class="glow" cx="50" cy="65" rx="28" ry="34" fill="url(#glow)"/>
        <!-- nan hoa ngang -->
        <g stroke="#7c2f00" stroke-width="2" opacity=".75">
          <path d="M18 50 H82"/><path d="M16 65 H84"/><path d="M18 80 H82"/>
        </g>
        <!-- ƒë·ªânh v√† ƒë√°y -->
        <rect x="30" y="22" width="40" height="8" rx="3" fill="#702800"/>
        <rect x="26" y="106" width="48" height="9" rx="4" fill="#702800"/>
        <!-- d√¢y treo -->
        <path d="M50 20 V6" stroke="#d0c9b0" stroke-width="2"/>
        <circle cx="50" cy="6" r="2" fill="#d0c9b0"/>
        <!-- tua rua -->
        <path d="M50 115 v18" stroke="#ffcf5a" stroke-width="3"/>
        <circle cx="50" cy="136" r="5" fill="#ffcf5a"/>
      </svg>`;
    }

    const lanternHost = document.getElementById('lanterns');
    function spawnLanterns(n=9){
      for(let i=0;i<n;i++){
        const el = document.createElement('div');
        el.className = 'lantern';
        el.innerHTML = lanternSVG();
        el.style.left = (5 + Math.random()*90) + 'vw';
        el.style.animationDuration = (40 + Math.random()*18) + 's';
        el.style.animationDelay = (-Math.random()*38) + 's';
        el.style.transform = `translateY(${Math.random()*40}vh)`; // offset ban ƒë·∫ßu kh√°c nhau
        el.style.opacity = (0.55 + Math.random()*0.4).toFixed(2);
        el.style.filter += ` drop-shadow(0 0 ${6+Math.random()*8}px #ffd07a)`;
        lanternHost.appendChild(el);
      }
    }
    spawnLanterns(10);

    /* ----------------------------------------
       6) √ÇM NH·∫†C ‚Äì th·ª≠ ph√°t t·ª± ƒë·ªông; n·∫øu th·∫•t b·∫°i th√¨ xin ph√©p
       ---------------------------------------- */
    const audio = document.getElementById('bgm');
    const gate = document.getElementById('gate');
    const gatePlay = document.getElementById('gatePlay');
    const toggleMute = document.getElementById('toggleMute');

    async function tryPlay(){
      try {
        audio.volume = 0.85; // √¢m l∆∞·ª£ng m·∫∑c ƒë·ªãnh
        await audio.play();
        gate.classList.add('hide');
        toggleMute.textContent = 'üîä ƒêang ph√°t';
      } catch (err){
        // B·ªã ch·∫∑n ‚Äì hi·ªán l·ªõp xin ph√©p
        gate.classList.remove('hide');
        toggleMute.textContent = 'üîá ƒêang t·∫Øt (nh·∫•n ƒë·ªÉ b·∫≠t)';
      }
    }

    // c·ªë g·∫Øng ph√°t ngay khi t·∫£i
    tryPlay();

    gatePlay.addEventListener('click', async () => { await tryPlay(); });
    // ph√°t khi c√≥ b·∫•t k·ª≥ t∆∞∆°ng t√°c l·∫ßn ƒë·∫ßu
    const firstInteract = () => { tryPlay(); window.removeEventListener('pointerdown', firstInteract); };
    window.addEventListener('pointerdown', firstInteract);

    toggleMute.addEventListener('click', () => {
      if(audio.paused){ audio.play(); toggleMute.textContent = 'üîä ƒêang ph√°t'; gate.classList.add('hide'); }
      else { audio.pause(); toggleMute.textContent = 'üîá ƒêang t·∫Øt'; }
    });
  })();
  </script>
</body>
</html>
